name: "nix-config"

packages:
  - cargo
  - doppler
  - gcc
  - git
  - home-manager
  - jq
  - niv
  - pre-commit
  - shellcheck
  - wget

aliases:
  update-all: |
    find -L "$(pwd)/" -type f -name "update-sources.sh" | while read -r updatescript; do ( dir="$(dirname -- "$updatescript")"; cd "$dir" || exit; $updatescript ); done
  build: |
    export NIXPKGS_ALLOW_UNFREE=1
    ci="$(git rev-parse --show-toplevel)/ci.nix"
    if [[ -z "$1" ]]; then
      nix run nixpkgs.nix-output-monitor -c nom-build "$ci"
    else
      nix run nixpkgs.nix-output-monitor -c nom-build "$ci" -A "$1"
    fi

env:
  PRE_COMMIT_COLOR: "never"
  SHELLCHECK_OPTS: "-e SC1008"

run: |
  [[ -f .git/hooks/pre-commit ]] || pre-commit install --install-hooks
